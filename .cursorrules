# Cursor AI Rules - Track Sustainability Extension

## Contexte du projet

Ce projet est une **extension Chrome** (Manifest V3) pour estimer et visualiser l'impact CO‚ÇÇ des requ√™tes LLM.

## Structure importante

- `client/public/` : Fichiers de l'extension Chrome (NE PAS TOUCHER aux autres dossiers pour l'extension)
- `manifest.json` : Configuration de l'extension
- `popup.html/js` : Interface utilisateur
- `content.js` : D√©tection des conversations LLM
- `background.js` : Service worker avec calculs
- `predictor.js` : Mod√®le ML simplifi√©
- `data/` : Donn√©es du mod√®le et facteurs CO‚ÇÇ

## Technologies utilis√©es

- **JavaScript vanilla** (pas de framework) pour l'extension
- **Chrome Extension API** (Storage, Runtime, Tabs)
- **Machine Learning** : Mod√®le Gradient Boosting (R¬≤=0.984)
- **Manifest V3** (pas V2)

## R√®gles de d√©veloppement

### Pour l'extension Chrome

1. **Pas d'imports ES6** : Utiliser uniquement du JavaScript vanilla
2. **Pas de npm modules** : Tout doit fonctionner sans build
3. **Async/await** : Pr√©f√©rer async/await aux callbacks
4. **Chrome API** : Utiliser chrome.storage.local, chrome.runtime, etc.
5. **Permissions** : Minimiser les permissions demand√©es

### Style de code

1. **Commentaires** : Ajouter des commentaires explicatifs en fran√ßais
2. **Nommage** : camelCase pour les variables, PascalCase pour les classes
3. **Fonctions** : Une fonction = une responsabilit√©
4. **Erreurs** : Toujours g√©rer les erreurs avec try/catch
5. **Console** : Utiliser console.log avec des emojis pour le debug (üå±, üìä, ‚ö†Ô∏è, ‚ùå)

### Bonnes pratiques

1. **Storage** : Toujours v√©rifier que les donn√©es existent avant de les lire
2. **Messages** : Utiliser chrome.runtime.sendMessage pour communiquer entre scripts
3. **D√©tection** : Utiliser des s√©lecteurs CSS robustes qui ne cassent pas facilement
4. **Performance** : √âviter les boucles infinies et les requ√™tes excessives
5. **S√©curit√©** : Ne jamais stocker de donn√©es sensibles

## Commandes utiles

```bash
# Voir les instructions d'installation
npm run extension:install

# Cr√©er le package ZIP
npm run extension:build

# Surveiller les changements
npm run extension:watch
```

## D√©buggage

- **Popup** : Clic droit sur l'ic√¥ne ‚Üí Inspecter la vue popup
- **Content script** : F12 sur la page LLM ‚Üí Console
- **Background** : chrome://extensions/ ‚Üí Service worker

## Fichiers √† ne pas modifier

- `package.json` (sauf pour ajouter des scripts)
- `dist/` (g√©n√©r√© automatiquement)
- `node_modules/` (si pr√©sent)

## Fichiers √† modifier pour l'extension

- `client/public/popup.html` : Interface
- `client/public/popup.js` : Logique du popup
- `client/public/content.js` : D√©tection
- `client/public/background.js` : Calculs
- `client/public/data/carbon_intensity.json` : Ajouter des pays

## Mod√®le ML

- **Performance** : R¬≤ = 0.984
- **Features** : response_token_length (47%), total_tokens (26%), model_size (20%)
- **Formule** : √ânergie = Base + (Prompt √ó 0.3 √ó E/token) + (Response √ó 1.0 √ó E/token)

## Facteurs CO‚ÇÇ

- Su√®de : 13 gCO‚ÇÇ/kWh (le plus propre)
- France : 52 gCO‚ÇÇ/kWh
- Mondial : 480 gCO‚ÇÇ/kWh
- Chine : 581 gCO‚ÇÇ/kWh
- Afrique du Sud : 750 gCO‚ÇÇ/kWh (le plus carbon√©)

## Aide de l'IA

Quand tu aides sur ce projet :
1. Toujours v√©rifier que le code est compatible Chrome Extension
2. Utiliser JavaScript vanilla (pas de JSX, pas de TypeScript dans l'extension)
3. Tester mentalement que le code fonctionne sans build
4. Sugg√©rer des am√©liorations de performance
5. Expliquer clairement les changements

## Documentation

- README.md : Documentation compl√®te
- INSTALLATION.md : Guide d'installation
- CURSOR_GUIDE.md : Guide pour Cursor
- EXECUTIVE_SUMMARY.md : R√©sum√© du projet
